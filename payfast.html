<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PakBet â€” PayFast Payment</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "pakbet-b0abe.firebaseapp.com",
      projectId: "pakbet-b0abe",
      storageBucket: "pakbet-b0abe.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
</head>
<body class="bg-gray-100 text-gray-800 p-4">
  <h1 class="text-xl font-bold mb-4">Pay with PayFast</h1>

  <form id="payfastForm" action="https://sandbox.payfast.co.za/eng/process" method="post">
    <!-- Merchant credentials -->
    <input type="hidden" name="merchant_id" value="10031690">
    <input type="hidden" name="merchant_key" value="aweba9ac-a921-44a0-31b2-159849c4ccfc">

    <!-- Return URLs -->
    <input type="hidden" name="return_url" value="https://www.pakbet.online/payfast_success.html">
    <input type="hidden" name="cancel_url" value="https://www.pakbet.online/payfast_cancel.html">
    <input type="hidden" name="notify_url" value="https://www.pakbet.online/payfast_notify">

    <!-- Transaction info -->
    <input type="hidden" name="amount" id="amount" value="">
    <input type="hidden" name="item_name" value="PakBet Wallet Top-Up">
    <input type="hidden" name="custom_str1" id="custom_str1" value="">

    <!-- Payment UI -->
    <label for="topupAmount">Enter amount (R):</label><br>
    <input type="number" id="topupAmount" min="1" required class="border p-2 rounded"><br><br>

    <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Pay Now</button>
  </form>

  <script>
    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        document.getElementById("custom_str1").value = user.uid;

        const form = document.getElementById("payfastForm");
        form.addEventListener("submit", (e) => {
          const amount = document.getElementById("topupAmount").value;
          if (!amount || parseFloat(amount) < 1) {
            e.preventDefault();
            alert("Please enter a valid amount.");
            return;
          }
          document.getElementById("amount").value = parseFloat(amount).toFixed(2);
        });
      } else {
        alert("You must be logged in to top up your wallet.");
        window.location.href = "/login.html";
      }
    });
  </script>
</body>
</html>
